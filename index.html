<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nova Services</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://unpkg.com/lucide-static/font/lucide.css">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyD8wFHf9XbX4dhnprngXcnK53WhSbhJtyQ",
  authDomain: "novaservices-819e8.firebaseapp.com",
  projectId: "novaservices-819e8",
  storageBucket: "novaservices-819e8.firebasestorage.app",
  messagingSenderId: "574173549200",
  appId: "1:574173549200:web:126b6b1b3681c670943e15",
  measurementId: "G-LGKDDP8XH5"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* CONFIG */
const WEBHOOK = "https://discord.com/api/webhooks/1455489501852864645/Nc3JTy3nCiFLZ2RgKqBTvzBWcb6WLFX5qyeToE5lSBcKA5mL3f5SORLItIo9VKvV2pTa";
const WORKINK = "https://work.ink/268k/10-tokens";

/* PAGE SWITCH */
window.show = id => {
  document.querySelectorAll(".page").forEach(p => p.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
};

/* AUTH */
window.login = async () =>
  signInWithEmailAndPassword(auth, loginEmail.value, loginPassword.value);

window.register = async () => {
  const cred = await createUserWithEmailAndPassword(auth, regEmail.value, regPassword.value);
  await setDoc(doc(db, "users", cred.user.uid), {
    email: cred.user.email,
    tokens: 0,
    lastClaim: null
  });
};

/* LOGOUT */
window.logout = () => signOut(auth);

/* WORKINK FLOW */
window.goWorkink = () => {
  sessionStorage.setItem("workinkVisited", "true");
  window.open(WORKINK);
};

/* CLAIM WITH TIMER */
window.claim = async () => {
  if (!sessionStorage.getItem("workinkVisited")) {
    alert("Complete Work.ink first.");
    return;
  }

  const ref = doc(db, "users", auth.currentUser.uid);
  const snap = await getDoc(ref);

  const last = snap.data().lastClaim?.toMillis();
  if (last && Date.now() - last < 86400000) {
    alert("Cooldown active.");
    return;
  }

  await updateDoc(ref, {
    tokens: increment(10),
    lastClaim: serverTimestamp()
  });

  sessionStorage.removeItem("workinkVisited");
  loadUser();
};

/* TIMER */
function updateTimer(last) {
  if (!last) return timer.innerText = "Ready";
  const diff = 86400000 - (Date.now() - last);
  if (diff <= 0) return timer.innerText = "Ready";

  const h = Math.floor(diff / 3600000);
  const m = Math.floor(diff % 3600000 / 60000);
  const s = Math.floor(diff % 60000 / 1000);
  timer.innerText = `${h}h ${m}m ${s}s`;
}

/* VALIDATION */

/* ORDER */
window.placeOrder = async type => {
  const target = document.getElementById(type+"Id").value;
  const amount = Number(document.getElementById(type+"Amount").value);
  const ref = doc(db, "users", auth.currentUser.uid);
  const snap = await getDoc(ref);

  if (snap.data().tokens < amount) return alert("Not enough tokens");

  await updateDoc(ref, { tokens: increment(-amount) });

  await fetch(WEBHOOK, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      embeds: [{
        title: "ğŸ“¦ New Order",
        color: 16711680,
        fields: [
          { name: "Email", value: auth.currentUser.email },
          { name: "Origin", value: "Website" },
          { name: "Type", value: type },
          { name: "Target", value: `https://roblox.com/users/${target}/profile` },
          { name: "Amount", value: amount.toString() }
        ]
      }]
    })
  });

  loadUser();
  alert("Order placed");
};

/* LOAD */
async function loadUser() {
  const snap = await getDoc(doc(db, "users", auth.currentUser.uid));
  tokens.innerText = snap.data().tokens;
  updateTimer(snap.data().lastClaim?.toMillis());
}

onAuthStateChanged(auth, u => u ? (show("dashboard"), loadUser()) : show("lander"));
</script>
</head>

<body class="bg-black text-white">

<!-- LANDER -->
<section id="lander" class="page min-h-screen flex flex-col items-center justify-center text-center space-y-8">
  <h1 class="text-6xl font-bold">
    Nova<span class="text-red-500">Services</span>
  </h1>
  <p class="text-gray-400">Free Roblox Followers â€¢ High Uptime â€¢ Automated</p>

  <div class="grid grid-cols-3 gap-6 max-w-4xl">
    <div class="bg-zinc-900 p-6 rounded-2xl">âš¡ Fast Delivery</div>
    <div class="bg-zinc-900 p-6 rounded-2xl">ğŸ›¡ Secure Tokens</div>
    <div class="bg-zinc-900 p-6 rounded-2xl">ğŸ“¦ Automated Orders</div>
  </div>

  <button onclick="show('auth')" class="bg-red-600 px-10 py-4 rounded-2xl">
    Get Started
  </button>
</section>

<!-- AUTH -->
<section id="auth" class="page hidden min-h-screen flex items-center justify-center gap-10">
  <div class="bg-zinc-900 p-8 rounded-3xl w-96">
    <h2 class="text-2xl mb-4">Login</h2>
    <input id="loginEmail" placeholder="Email" class="w-full p-3 bg-black rounded-xl mb-3">
    <input id="loginPassword" type="password" placeholder="Password" class="w-full p-3 bg-black rounded-xl mb-4">
    <button onclick="login()" class="w-full bg-red-600 py-3 rounded-xl">Login</button>
  </div>

  <div class="bg-zinc-900 p-8 rounded-3xl w-96 border border-red-500">
    <h2 class="text-2xl mb-4 text-red-400">Register</h2>
    <input id="regEmail" placeholder="Email" class="w-full p-3 bg-black rounded-xl mb-3">
    <input id="regPassword" type="password" placeholder="Password" class="w-full p-3 bg-black rounded-xl mb-4">
    <button onclick="register()" class="w-full bg-zinc-800 py-3 rounded-xl">Create Account</button>
  </div>
</section>

<!-- DASHBOARD -->
<section id="dashboard" class="page hidden p-10 space-y-10">
  <div class="flex justify-between">
    <h2 class="text-3xl">Dashboard</h2>
    <button onclick="logout()" class="text-red-400">Logout</button>
  </div>

  <div class="grid grid-cols-3 gap-6">
    <div class="bg-zinc-900 p-6 rounded-2xl">ğŸ’° Tokens<br><span id="tokens" class="text-3xl text-red-500">0</span></div>
    <div class="bg-zinc-900 p-6 rounded-2xl">â± Claim In<br><span id="timer">Ready</span></div>
    <div class="bg-zinc-900 p-6 rounded-2xl">ğŸŸ¢ System Online</div>
  </div>

  <div class="flex gap-4">
    <button onclick="goWorkink()" class="bg-zinc-800 px-6 py-3 rounded-xl">Work.ink</button>
    <button onclick="claim()" class="bg-red-600 px-6 py-3 rounded-xl">Claim</button>
  </div>

  <div class="grid grid-cols-2 gap-6">
    <div class="bg-zinc-900 p-6 rounded-2xl">
      <h3 class="mb-4">Followers</h3>
      <input id="userId" placeholder="User ID" class="w-full p-3 bg-black rounded mb-3">
      <input id="userAmount" type="number" placeholder="Amount" class="w-full p-3 bg-black rounded mb-3">
      <button onclick="placeOrder('user')" class="w-full bg-red-600 py-3 rounded-xl">Order</button>
    </div>

    <div class="bg-zinc-900 p-6 rounded-2xl">
      <h3 class="mb-4">Group Members</h3>
      <input id="groupId" placeholder="Group ID" class="w-full p-3 bg-black rounded mb-3">
      <input id="groupAmount" type="number" placeholder="Amount" class="w-full p-3 bg-black rounded mb-3">
      <button onclick="placeOrder('group')" class="w-full bg-red-600 py-3 rounded-xl">Order</button>
    </div>
  </div>
</section>

</body>
</html>
